# Music For You, just ENJOY IT!

## Some Ideas

### 根据文件夹自动建立的歌单

比起手工建，更适合我的使用场景。

### 音乐转发

当你恰好想听 A 手机上的歌，而又因种种原因不能在 A 手机上放（譬如没有 3.5 毫米耳机接口），这时就可以用音乐转发功能，使用 B 手机听 A 手机上的歌（当然不能是单纯的发文件）。

预想方案：使用 NFC 配对，通过蓝牙或网络建立连接，通过 `MediaRecorder` 获取设备音频或者直接发送歌曲音频数据，由对方程序接受播放（B 手机可以选择同步播放或不播放（如果可能的实现的话（好像是可以的，我发现录屏时即使不开声音也能录进声音）））。此时可以由 B 手机接管 A 手机的音量控制，如果恰好的也是用此软件播放的，可以接管全部播放控制（类似于 remote develop 的体验）。如果 A 手机当前媒体暴露了 `MediaBrowserService` 则 B 手机可以转发 `MediaButton` 到 A 手机。

### 心跳式渐进睡眠

常常会发生睡眠计时结束但还没睡着的情况，这时候如果亮屏去继续播放，就要被亮瞎。所以如果在睡眠计时结束后，音量被调节（不用眼镜和亮屏就可以完成），就会重新开始一次睡眠计时，但是计时的时间会一定程度的减少。

### 再播放一次

将当前歌曲加入播放列表，保证一定下一首播放，播放后自动从播放列表中移除。

### 时限内记录播放进度

如果不是临时暂停再播放，我肯定更想从一首完整的歌开始播放。

### 播放列表自动保存

如果当前播放列表被程序逻辑删除（比如播放一个歌单）而不是用户手动删除，会自动保存为歌单。

## 逻辑

UI 由一个主 Activity 和一堆 Fragment 组成。对于组件间的交互逻辑按照以下几条规则执行。

- 由 Fragment/Activity 内部触发的且 Fragment/Activity 自身可以完成的（包括交由子组件）交互由 Fragment/Activity 自行处理。
- 由 Fragment 内部触发的但自身无法完成的交互由 ViewModel 处理。（Fragment 发送数据或调用函数，ViewModel 做数据处理，Activity 或其他 Fragment observe 和执行）。
- 由 Activity 内部触发的需要由**当前**显示的 Fragment 处理的（主要是 App Bar 的返回和菜单点击以及 Bottom Navigation View 的 Reselect 和 FAB 点击这四个事件），通过 `IHandleBackPress`、`IhandleMenuItemClick` 和 `IHandleNavigtionReselect` 等接口将事件向下传递。

### 歌单页

包括歌单列表和歌单中歌曲列表两个页面。歌单列表为默认显示页。

||后退按钮|菜单内容|FAB| 标题 | 副标题 |
| - | - | - | - | - | - |
| 歌单列表页 | 无 | 无 | 新增歌单 | 程序名 | 无 |
| 歌单列表页多选 | 取消选择 | 删除歌单（由文件夹建立的歌单是无法被删除的）| 无 | 程序名 | 无 |
| 歌单歌曲列表页 | 返回歌单列表页 | 删除歌单（若为文件夹建立的歌单则无菜单内容） | 播放歌单 | 歌单名称 | 歌单歌曲数 |
| 歌单歌曲列表页多选 | 取消多选 | 全选、加入播放队列、添加到其他歌单、从歌单中移除（若为文件夹建立的歌单则无此项）| 无 | 歌单名称 | 选择歌曲数 |

```kotlin
fun 歌曲点击(歌曲编号) {
    when (设置.在歌单中点击歌曲的操作) {
        预览歌曲 -> 预览歌曲() // 使用一个对话框实现
        播放歌曲 -> {
            加入播放列表(当前歌曲后面)
            播放控制.下一首()
        }
        播放歌单 -> {
            保存播放列表到歌单()
            载入播放列表(当前歌单)
            播放控制.播放(歌曲编号)
        }
    }
}

fun 播放歌单() {
    保存播放列表到歌单()
    载入播放列表(当前歌单)
    播放控制.播放(队列首)
}
```

### 歌曲页

显示当前播放歌曲页（也可能像传统音乐播放器一样位于底部的一个入口和一个新页面）和播放列表
